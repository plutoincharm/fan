%%% compute joint torques for 3D case
function torques = torques2D(q,qdot,qddot,GRF,cop)
%%%
global L r m MI g
L1 = L(1);
L2 = L(2);
r1 = r(1);
r2 = r(2);
r3 = r(3);
m1 = m(1);
m2 = m(2);
m3 = m(3);
MI1 = MI(1);
MI2 = MI(2);
MI3 = MI(3);
xhip = q(1);
yhip = q(2);
tht1 = q(3);
tht2 = q(4);
tht3 = q(5);
vxhip = qdot(1);
vyhip = qdot(2);
omg1 = qdot(3);
omg2 = qdot(4);
omg3 = qdot(5);
axhip = qddot(1);
ayhip = qddot(2);
alp1 = qddot(3);
alp2 = qddot(4);
alp3 = qddot(5);
GRFx = GRF(1);
GRFy = GRF(2);
xcop = cop(1);
ycop = cop(2);

T1=alp1.*L1.^2.*m2+alp1.*L1.^2.*m3+alp2.*L2.^2.*m3+alp1.*MI1+alp2.* ...
  MI2+alp3.*MI3+alp1.*m1.*r1.^2+alp2.*m2.*r2.^2+alp3.*m3.*r3.^2+(-1) ...
  .*GRFy.*xcop+GRFy.*xhip+GRFx.*ycop+(-1).*GRFx.*yhip+(-1).*axhip.*( ...
  L1.*(m2+m3)+m1.*r1).*cos(tht1)+(alp1+alp2).*L1.*(L2.*m3+m2.*r2).* ...
  cos(tht1+(-1).*tht2)+(-1).*axhip.*L2.*m3.*cos(tht2)+(-1).*axhip.* ...
  m2.*r2.*cos(tht2)+alp1.*L1.*m3.*r3.*cos(tht1+(-1).*tht3)+alp3.* ...
  L1.*m3.*r3.*cos(tht1+(-1).*tht3)+alp2.*L2.*m3.*r3.*cos(tht2+(-1).* ...
  tht3)+alp3.*L2.*m3.*r3.*cos(tht2+(-1).*tht3)+(-1).*axhip.*m3.*r3.* ...
  cos(tht3)+(-1).*ayhip.*L1.*m2.*sin(tht1)+(-1).*g.*L1.*m2.*sin( ...
  tht1)+(-1).*ayhip.*L1.*m3.*sin(tht1)+(-1).*g.*L1.*m3.*sin(tht1)+( ...
  -1).*ayhip.*m1.*r1.*sin(tht1)+(-1).*g.*m1.*r1.*sin(tht1)+(-1).* ...
  L1.*L2.*m3.*omg1.^2.*sin(tht1+(-1).*tht2)+L1.*L2.*m3.*omg2.^2.* ...
  sin(tht1+(-1).*tht2)+(-1).*L1.*m2.*omg1.^2.*r2.*sin(tht1+(-1).* ...
  tht2)+L1.*m2.*omg2.^2.*r2.*sin(tht1+(-1).*tht2)+(-1).*ayhip.*L2.* ...
  m3.*sin(tht2)+(-1).*g.*L2.*m3.*sin(tht2)+(-1).*ayhip.*m2.*r2.*sin( ...
  tht2)+(-1).*g.*m2.*r2.*sin(tht2)+(-1).*L1.*m3.*omg1.^2.*r3.*sin( ...
  tht1+(-1).*tht3)+L1.*m3.*omg3.^2.*r3.*sin(tht1+(-1).*tht3)+(-1).* ...
  L2.*m3.*omg2.^2.*r3.*sin(tht2+(-1).*tht3)+L2.*m3.*omg3.^2.*r3.* ...
  sin(tht2+(-1).*tht3)+(-1).*ayhip.*m3.*r3.*sin(tht3)+(-1).*g.*m3.* ...
  r3.*sin(tht3);

T2=alp2.*L2.^2.*m3+alp2.*MI2+alp3.*MI3+alp2.*m2.*r2.^2+alp3.*m3.* ...
  r3.^2+(-1).*GRFy.*xcop+GRFy.*xhip+GRFx.*ycop+(-1).*GRFx.*yhip+(-1) ...
  .*GRFx.*L1.*cos(tht1)+alp1.*L1.*(L2.*m3+m2.*r2).*cos(tht1+(-1).* ...
  tht2)+(-1).*axhip.*L2.*m3.*cos(tht2)+(-1).*axhip.*m2.*r2.*cos( ...
  tht2)+alp1.*L1.*m3.*r3.*cos(tht1+(-1).*tht3)+alp2.*L2.*m3.*r3.* ...
  cos(tht2+(-1).*tht3)+alp3.*L2.*m3.*r3.*cos(tht2+(-1).*tht3)+(-1).* ...
  axhip.*m3.*r3.*cos(tht3)+(-1).*GRFy.*L1.*sin(tht1)+(-1).*L1.*L2.* ...
  m3.*omg1.^2.*sin(tht1+(-1).*tht2)+(-1).*L1.*m2.*omg1.^2.*r2.*sin( ...
  tht1+(-1).*tht2)+(-1).*ayhip.*L2.*m3.*sin(tht2)+(-1).*g.*L2.*m3.* ...
  sin(tht2)+(-1).*ayhip.*m2.*r2.*sin(tht2)+(-1).*g.*m2.*r2.*sin( ...
  tht2)+(-1).*L1.*m3.*omg1.^2.*r3.*sin(tht1+(-1).*tht3)+(-1).*L2.* ...
  m3.*omg2.^2.*r3.*sin(tht2+(-1).*tht3)+L2.*m3.*omg3.^2.*r3.*sin( ...
  tht2+(-1).*tht3)+(-1).*ayhip.*m3.*r3.*sin(tht3)+(-1).*g.*m3.*r3.* ...
  sin(tht3);

T3=alp3.*MI3+alp3.*m3.*r3.^2+(-1).*GRFy.*xcop+GRFy.*xhip+GRFx.*ycop+( ...
  -1).*GRFx.*yhip+(-1).*GRFx.*L1.*cos(tht1)+(-1).*GRFx.*L2.*cos( ...
  tht2)+alp1.*L1.*m3.*r3.*cos(tht1+(-1).*tht3)+alp2.*L2.*m3.*r3.* ...
  cos(tht2+(-1).*tht3)+(-1).*axhip.*m3.*r3.*cos(tht3)+(-1).*GRFy.* ...
  L1.*sin(tht1)+(-1).*GRFy.*L2.*sin(tht2)+(-1).*L1.*m3.*omg1.^2.* ...
  r3.*sin(tht1+(-1).*tht3)+(-1).*L2.*m3.*omg2.^2.*r3.*sin(tht2+(-1) ...
  .*tht3)+(-1).*ayhip.*m3.*r3.*sin(tht3)+(-1).*g.*m3.*r3.*sin(tht3); ...

torques = [T1 T2 T3];

end